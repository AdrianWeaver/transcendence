generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Chat {
  chatId            String    @id @default(uuid())
  users             User[]
  channels          Channel[]
  chanMap           Json[]
  privateMessageMap Json[]
}

model User {
  userId       String         @id @default(uuid())
  name         String         @unique // ?
  isAdmin      Role           @default(BASIC)
  channels     Channel[]      @relation("UserChannels")
  UserChannels UserChannels[]
  blocked      BlockedUser[]
  friends      Json[]
  chatId       String
  chat         Chat           @relation(fields: [chatId], references: [chatId])
}

model Channel {
  channelId    String         @id @default(uuid())
  users        User[]         @relation("UserChannels")
  mode         ChanMode       @default(PUBLIC)
  owner        String
  banned       BannedUser[]
  admins       Admins[]
  name         String         @unique
  password     String?
  messages     Json[]
  members      Int
  UserChannels UserChannels[]
  chatId       String
  chat         Chat           @relation(fields: [chatId], references: [chatId])
}

model UserChannels {
  userId    String
  channelId String
  User      User    @relation(fields: [userId], references: [userId])
  Channel   Channel @relation(fields: [channelId], references: [channelId])

  @@id([userId, channelId])
}

model BannedUser {
  id        String  @id @default(uuid())
  channelId String
  channel   Channel @relation(fields: [channelId], references: [channelId])
}

model BlockedUser {
  id     String @id @default(uuid())
  userId String
  user   User   @relation(fields: [userId], references: [userId])
}

model Admins {
  id        String  @id @default(uuid())
  channelId String
  channel   Channel @relation(fields: [channelId], references: [channelId])
}

// model ChanMapModel {
//   id             Int      @id @default(autoincrement())
//   name           String   @unique
//   mode           String
//   chatId         String
//   chat           Chat     @relation(fields: [chatId], references: [chatId])
// }

enum Role {
  BASIC
  ADMIN
  OWNER
}

enum ChanMode {
  PUBLIC
  PRIVATE
  PROTECTED
}
